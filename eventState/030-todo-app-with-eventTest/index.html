<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>030 Todo App with eventTest</title>
  <link rel="stylesheet" href="style.css">
</head>
<body data-theme="light" data-bind="data-theme: ui.theme">
  <nav style="display:flex; gap:10px; align-items:center; padding:10px 12px;">
    <a href="/" data-link>Home</a>
    <a href="/todo-demo" data-link>Todo app demo</a>
    <span style="flex:1"></span>
    <button class="btn" title="Toggle theme" data-on="click: toggleTheme() | log('toggle theme') | logPath('ui.theme')">Theme</button>
  </nav>
  <div data-route-root>
    <main style="max-width: 600px; margin: 2rem auto; padding: 0 1rem;">
      <h1>Home works!</h1>
      <p>This is the home page of the todo app example.</p>
      <p><a href="/todo-demo" data-link>Go to Todo App Demo â†’</a></p>
    </main>
  </div>

  <!-- Router setup -->
  <script type="module" src="./app/router.js"></script>
  <!-- Behaviors runtime (declarative data-bind and data-on) -->
  <script type="module">
    import store from './app/store.js';
    import { installBehaviors } from './runtime/core/behaviors.runtime.js';
    
    // Inline actions for nav buttons
    const registry = {
      toggleTheme(ctx) {
        const cur = ctx.get('ui.theme');
        const next = (cur === 'dark') ? 'light' : 'dark';
        ctx.set('ui.theme', next);
      },
      log(ctx, ...args) {
        console.log('[action]', ...args);
      },
      logPath(ctx, path) {
        console.log('[action]', String(path), ctx.get(String(path)));
      }
    };
    
    installBehaviors(store, {
      registry,
      root: document,
      writablePrefixes: ['ui.', 'todos.'],
      debug: false
    });
    
    // Initialize theme
    if (!store.get('ui.theme')) {
      const prefersDark = window.matchMedia?.('(prefers-color-scheme: dark)').matches;
      store.set('ui.theme', prefersDark ? 'dark' : 'light');
    }
    
    // Persist theme to localStorage
    store.subscribe('ui.theme', (theme) => {
      localStorage.setItem('ui.theme', theme);
    });
  </script>
</body>
</html>